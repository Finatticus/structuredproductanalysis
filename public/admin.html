<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;font-family:"Segoe UI","Noto Sans TC",Arial,sans-serif;}
body{margin:0;background:linear-gradient(135deg,#f5f7fa,#e8edf3);color:#1f2937;padding:20px;}
.container{max-width:900px;margin:0 auto;background:#fff;padding:30px;border-radius:14px;box-shadow:0 20px 40px rgba(0,0,0,0.08);}
h1{margin-top:0;color:#0f2a44;}
table{width:100%;border-collapse:collapse;margin-top:20px;}
th,td{border:1px solid #d1d5db;padding:8px;text-align:center;}
th{background:#f3f4f6;}
button{padding:6px 12px;border:none;border-radius:6px;background:#0f2a44;color:#fff;cursor:pointer;margin:2px;}
button:hover{background:#143a5c;}
</style>
</head>
<body>
<div class="container">
  <h1>Admin Dashboard</h1>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>帳號</th>
        <th>角色</th>
        <th>狀態</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody id="userTable"></tbody>
  </table>
</div>

<script>
const API_BASE = "https://structuredproductanalysis.onrender.com";

async function loadUsers(){
  const res = await fetch(API_BASE+"/admin/users");
  const users = await res.json();
  const tbody = document.getElementById("userTable");
  tbody.innerHTML="";
  users.forEach(u=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${u.id}</td>
      <td>${u.username}</td>
      <td>${u.role}</td>
      <td>${u.status}</td>
      <td>
        ${u.status==="pending"?`<button onclick="approve(${u.id})">批准</button>`:""}
        <button onclick="del(${u.id})">刪除</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

async function approve(id){
  await fetch(API_BASE+"/admin/approve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id})});
  loadUsers();
}

async function del(id){
  if(confirm("確定要刪除嗎？")){
    await fetch(API_BASE+"/admin/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id})});
    loadUsers();
  }
}

// 初始載入
loadUsers();
</script>
</body>
</html>
