<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Gemini 私人對話 (Debug 版)</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; background: #f4f4f4; }
        #chat-box { height: 300px; overflow-y: auto; border: 1px solid #ccc; background: white; padding: 10px; margin-bottom: 10px; border-radius: 8px; }
        .error-msg { color: red; background: #ffdada; padding: 10px; border-radius: 5px; font-size: 12px; margin-top: 10px; border: 1px solid red; }
        textarea { width: 100%; height: 60px; margin-bottom: 10px; }
        input { width: 100%; margin-bottom: 10px; padding: 8px; box-sizing: border-box; }
    </style>
</head>
<body>
    <h3>Gemini 對話測試</h3>
    <input type="password" id="apiKey" placeholder="貼上你的 API Key">
    <div id="chat-box"></div>
    <textarea id="userInput" placeholder="輸入訊息..."></textarea>
    <button id="sendBtn">傳送</button>
    <div id="debug-info"></div>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        const btn = document.getElementById('sendBtn');
        const debugInfo = document.getElementById('debug-info');

        btn.onclick = async () => {
            const key = document.getElementById('apiKey').value.trim();
            const text = document.getElementById('userInput').value;
            debugInfo.innerHTML = ""; // 清除舊錯誤

            if(!key) return alert("請輸入 Key");

            try {
                const genAI = new GoogleGenerativeAI(key);
                // 強制指定使用 flash 模型，這是免費額度最穩定的
                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                
                const result = await model.generateContent(text);
                const response = await result.response;
                document.getElementById('chat-box').innerHTML += `<div><b>AI:</b> ${response.text()}</div>`;
            } catch (e) {
                console.error(e);
                // 這裡會抓出真正的錯誤原因
                debugInfo.innerHTML = `<div class="error-msg">
                    <b>偵測到錯誤：</b><br>
                    狀態碼: ${e.status || '未知'}<br>
                    原因: ${e.message}<br>
                    建議：請確認 Key 是否正確，或嘗試切換手機網路（避開公司防火牆）。
                </div>`;
            }
        };
    </script>
</body>
</html>
